# BEGIN htpw (.htaccess to protect WordPress)
#
# htpw was made with â™¥ by Andrea Draghetti
#
# https://github.com/drego85/htpw
#
# Version: 1.5 - Last Update: 21 Jan 2026
#
# This file may be licensed under the terms of of the
# GNU General Public License Version 3 (the ``GPL'').
#

# Protect System Files
<files .htaccess>
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
		Deny from all
	</IfModule>
</files>
<files readme.html>
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
		Deny from all
	</IfModule>
</files>
<files readme.txt>
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
		Deny from all
	</IfModule>
</files>
<files license.txt>
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
		Deny from all
	</IfModule>
</files>
<files wp-config.php>
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
		Deny from all
	</IfModule>
</files>
<files error_log>
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
		Deny from all
	</IfModule>
</files>
<files php_errorlog>
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
		Deny from all
	</IfModule>
</files>
<FilesMatch "\.(?i:sql|data|json|yml|ini)$">
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
		Deny from all
	</IfModule>
</FilesMatch>

# Disable Directory Listening
Options -Indexes

<IfModule mod_rewrite.c>
	RewriteEngine On

	# Protect System Files
	RewriteRule ^wp-admin/install\.php$ - [F,L]
	RewriteRule ^wp-admin/includes/ - [F,L]
	RewriteRule !^wp-includes/ - [S=3]
	RewriteRule ^wp-includes/[^/]+\.php$ - [F,L]
	RewriteRule ^wp-includes/js/tinymce/langs/.+\.php - [F,L]
	RewriteRule ^wp-includes/theme-compat/ - [F,L]
	RewriteCond %{REQUEST_FILENAME} -f
	RewriteRule (^|.*/)\.(git|svn)/.* - [F,L]
	RewriteRule \.(sql|data|json|yml|ini)$ - [F,L,NC]
	RewriteRule ^wp-content/debug\.log$ - [F,L]
	RewriteRule (^|/)error_log$ - [F,L]
	RewriteRule (^|/)php_errorlog$ - [F,L]

	# Disable PHP in Uploads
	RewriteRule ^wp\-content/uploads/.*\.(?:php[1-8]?|pht|phtml?|phps)\.?$ - [NC,F,L]

	# Disable PHP in Plugins
	# RewriteRule ^wp\-content/plugins/.*\.(?:php[1-8]?|pht|phtml?|phps)\.?$ - [NC,F,L]

	# Disable PHP in Themes
	# RewriteRule ^wp\-content/themes/.*\.(?:php[1-8]?|pht|phtml?|phps)\.?$ - [NC,F,L]
	
	# Block Malicious or Suspicious User Agent
	RewriteCond %{HTTP_USER_AGENT} "^360Spider" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^arachni" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^Batman" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^dirbuster" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^havij" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^nessus" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^Nikto" [NC,OR]	
	RewriteCond %{HTTP_USER_AGENT} "^Nmap" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^Nuclei" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^openvas" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^PhantomJS" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^s2bot" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^SCspider" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^sqlmap" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^sqlninja" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^w3af" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^Wappalyzer" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^WPScan" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^Zeus" [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} "^zgrab" [NC]
	RewriteRule ^.* - [F,L]
</IfModule>

# Block XML-RPC requests except JetPack or Akismet connections:
# - https://jetpack.com/support/hosting-faq/
# - https://jetpack.com/ips-v4.txt
# - https://blog.akismet.com/akismet-hosting-faq/
<files xmlrpc.php>
	<IfModule mod_authz_core.c>
		<RequireAny>
			Require ip 122.248.245.244/32
			Require ip 54.217.201.243/32
			Require ip 54.232.116.4/32
			Require ip 192.0.80.0/20
			Require ip 192.0.96.0/20
			Require ip 192.0.112.0/20
			Require ip 195.234.108.0/22
			Require ip 192.0.64.0/18
		</RequireAny>
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order deny,allow
		Deny from all
		allow from 122.248.245.244/32
		allow from 54.217.201.243/32
		allow from 54.232.116.4/32
		allow from 192.0.80.0/20
		allow from 192.0.96.0/20
		allow from 192.0.112.0/20
		allow from 195.234.108.0/22
		allow from 192.0.64.0/18
	</IfModule>
</files>

# Security Headers
<IfModule mod_headers.c>
	Header always set X-Frame-Options "SAMEORIGIN"
	Header always set X-Content-Type-Options "nosniff"
	Header always set Referrer-Policy "strict-origin-when-cross-origin"
	Header always set Permissions-Policy "accelerometer=(), autoplay=(), camera=(), clipboard-read=(), clipboard-write=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
	Header always set X-Permitted-Cross-Domain-Policies "none"
	Header always set X-XSS-Protection "0"
	Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains" "expr=%{HTTPS} == 'on'"

	# Content Security Policy (base, permissive for WP). Uncomment to enable.
	# Header always set Content-Security-Policy "default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'self'; img-src 'self' data: blob:; font-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self'; form-action 'self'; upgrade-insecure-requests"
</IfModule>

# END htpw
